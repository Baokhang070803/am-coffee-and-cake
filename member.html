<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="utf-8"/>
    <meta name="google-site-verification" content="PaAsbmk1XWa3-fOeh2_9aTtEK38RChaUkzoLMp8MIko" />
    <meta name="description" content="Tham gia chương trình hội viên của Ấm - Coffee and Cake để nhận ưu đãi độc quyền và tích lũy điểm thưởng!"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <link rel="shortcut icon" href="images/favicon.png"/>
    <title>Thành Viên - Ấm - Coffee and Cake</title>
    <link href="css/bootstrap.css" rel="stylesheet"/>
    <link href='https://fonts.googleapis.com/css?family=Roboto:400,300,300italic,400italic,500,700,500italic,100italic,100' rel='stylesheet' type='text/css'/>
    <link href="css/font-awesome.min.css" rel="stylesheet"/>
    <link rel="stylesheet" href="css/flexslider.css" type="text/css" media="screen"/>
    <link href="css/sequence-looptheme.css" rel="stylesheet" media="all"/>
    <link href="css/style.css" rel="stylesheet"/>
    <link href="css/mobile.css" rel="stylesheet"/>
    <!-- Chart.js cho biểu đồ -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- SweetAlert2 cho thông báo -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <style>
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.95);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 999999;
        }

        .loading-content {
            text-align: center;
        }

        .loading-logo {
            width: 150px;
            margin-bottom: 20px;
            animation: pulse 2s infinite;
        }

        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 5px solid #f3f3f3;
            border-top: 5px solid #A67C52;
            border-radius: 50%;
            margin: 20px auto;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
        /* Custom styles cho trang Membership */
        .membership-section {
            padding: 60px 0;
            background: #FFFFFF;
            position: relative;
            overflow: hidden;
        }
        .membership-title {
            font-size: 36px;
            color: #4A2F1A;
            font-weight: 600;
            text-align: center;
            margin-bottom: 20px;
            position: relative;
            animation: slideIn 0.8s ease;
        }
        .membership-title::after {
            content: '';
            display: block;
            width: 80px;
            height: 4px;
            background: #f7544a;
            margin: 10px auto;
        }
        .membership-subtitle {
            font-size: 18px;
            color: #666666;
            text-align: center;
            max-width: 700px;
            margin: 0 auto 40px;
            line-height: 1.6;
        }
        .membership-container {
            display: flex;
            flex-wrap: wrap;
            gap: 30px;
            margin-bottom: 40px;
        }
        .membership-info {
            flex: 1;
            min-width: 300px;
            background: #FFFFFF;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            padding: 20px;
            transition: all 0.3s ease;
        }
        .membership-info:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
        }
        .membership-info h3 {
            font-size: 24px;
            color: #4A2F1A;
            margin-bottom: 15px;
        }
        /* Cập nhật phần Thông tin thành viên */
        .avatar-container {
            text-align: center;
            margin-bottom: 20px;
        }
        .avatar {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            object-fit: cover;
            border: 3px solid #f7544a;
            transition: transform 0.3s ease;
        }
        .avatar:hover {
            transform: scale(1.05);
        }
        .user-details {
            display: flex;
            flex-direction: column;
            gap: 10px;
            text-align: center;
        }
        .user-details p {
            font-size: 16px;
            color: #333333;
            margin: 5px 0;
        }
        .user-details .edit-btn {
            background: #f7544a;
            color: #FFFFFF;
            padding: 10px;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            transition: background 0.3s ease;
            margin-top: 10px;
        }
        .user-details .edit-btn:hover {
            background: #d63c32;
        }
        /* Biểu đồ mua hàng */
        .purchase-chart {
            background: #FFFFFF;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            padding: 20px;
            margin-bottom: 40px;
        }
        .purchase-chart h3 {
            font-size: 24px;
            color: #4A2F1A;
            margin-bottom: 20px;
        }
        canvas#purchaseChart {
            max-height: 300px;
            min-height: 200px;
            height: 300px !important;
            width: 100% !important;
            display: block;
        }
        /* Cập nhật Lịch sử giao dịch */
        .transaction-history {
            background: #fff;
            border-radius: 18px;
            box-shadow: 0 6px 24px rgba(0,0,0,0.08);
            padding: 28px 18px 32px 18px;
            margin-bottom: 40px;
            overflow-x: auto;
        }

        .transaction-history h3 {
            font-size: 24px;
            color: #4A2F1A;
            margin-bottom: 25px;
            font-weight: 600;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .transaction-history h3 .filter-btn {
            font-size: 14px;
            padding: 8px 15px;
            background: #f7f7f7;
            border: 1px solid #eee;
            border-radius: 8px;
            color: #666;
            cursor: pointer;
            transition: all 0.3s;
        }

        .transaction-history h3 .filter-btn:hover {
            background: #f0f0f0;
            color: #333;
        }

        .transaction-table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
            margin-bottom: 20px;
        }

        .transaction-table th {
            background: #f8f9fa;
            color: #4A2F1A;
            font-weight: 600;
            font-size: 14px;
            padding: 15px 20px;
            text-align: left;
            border-bottom: 2px solid #eee;
            white-space: nowrap;
        }

        .transaction-table td {
            padding: 18px 20px;
            vertical-align: middle;
            border-bottom: 1px solid #eee;
            font-size: 14px;
            color: #333;
            background: #fff;
        }

        .transaction-table tr:hover td {
            background: #fafafa;
        }

        /* Style cho cột Mã đơn hàng */
        .transaction-table td.order-id {
            font-family: monospace;
            color: #f7544a;
            font-weight: 500;
        }

        /* Style cho cột Sản phẩm */
        .transaction-table td.products {
            max-width: 300px;
        }

        .product-list {
            margin: 0;
            padding: 0;
            list-style: none;
        }

        .product-item {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
        }

        .product-item:last-child {
            margin-bottom: 0;
        }

        .product-image {
            width: 40px;
            height: 40px;
            border-radius: 6px;
            margin-right: 12px;
            object-fit: cover;
            border: 1px solid #eee;
        }

        .product-info {
            flex: 1;
        }

        .product-name {
            font-weight: 500;
            color: #333;
            margin-bottom: 2px;
        }

        .product-quantity {
            font-size: 13px;
            color: #666;
        }

        /* Style cho cột Tổng tiền */
        .transaction-table td.total-amount {
            font-weight: 600;
            color: #f7544a;
        }

        /* Style cho cột Trạng thái */
        .status-badge {
            display: inline-flex;
            align-items: center;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 13px;
            font-weight: 500;
        }

        .status-badge::before {
            content: '';
            display: inline-block;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            margin-right: 8px;
        }

        .status-pending {
            background: #fff8e5;
            color: #ffc107;
        }

        .status-pending::before {
            background: #ffc107;
        }

        .status-processing {
            background: #e3f2fd;
            color: #2196f3;
        }

        .status-processing::before {
            background: #2196f3;
        }

        .status-shipped {
            background: #e8f5e9;
            color: #4caf50;
        }

        .status-shipped::before {
            background: #4caf50;
        }

        .status-delivered {
            background: #e8f5e9;
            color: #00c853;
        }

        .status-delivered::before {
            background: #00c853;
        }

        .status-cancelled {
            background: #fef2f2;
            color: #ef4444;
        }

        .status-cancelled::before {
            background: #ef4444;
        }

        /* Style cho nút hành động */
        .action-buttons {
            display: flex;
            gap: 8px;
        }

        .action-btn {
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            border: none;
        }

        .view-btn {
            background: #f0f0f0;
            color: #333;
        }

        .view-btn:hover {
            background: #e0e0e0;
        }

        .cancel-btn {
            background: #fef2f2;
            color: #ef4444;
        }

        .cancel-btn:hover {
            background: #fee2e2;
        }

        /* Style cho phân trang */
        .pagination-container {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid #eee;
        }

        .pagination-info {
            font-size: 14px;
            color: #666;
        }

        .pagination {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .pagination button {
            padding: 8px 16px;
            border: 1px solid #eee;
            background: #fff;
            border-radius: 8px;
            color: #333;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
        }

        .pagination button:hover:not(:disabled) {
            background: #f7f7f7;
            border-color: #ddd;
        }

        .pagination button:disabled {
            background: #f7f7f7;
            color: #999;
            cursor: not-allowed;
        }

        .pagination .page-number {
            padding: 8px 16px;
            font-size: 14px;
            color: #666;
        }

        /* Responsive styles */
        @media (max-width: 768px) {
            .transaction-history {
                padding: 20px 12px;
            }

            .transaction-table th,
            .transaction-table td {
                padding: 12px 10px;
                font-size: 13px;
            }

            .product-image {
                width: 32px;
                height: 32px;
            }

            .pagination-container {
                flex-direction: column;
                gap: 15px;
                align-items: center;
            }

            .pagination-info {
                text-align: center;
            }
        }

        /* Empty state style */
        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: #666;
        }

        .empty-state img {
            width: 120px;
            margin-bottom: 20px;
            opacity: 0.5;
        }

        .empty-state h4 {
            font-size: 18px;
            color: #333;
            margin-bottom: 10px;
        }

        .empty-state p {
            font-size: 14px;
            margin-bottom: 20px;
        }

        .empty-state .shop-now-btn {
            display: inline-block;
            padding: 10px 20px;
            background: #f7544a;
            color: #fff;
            border-radius: 8px;
            text-decoration: none;
            font-weight: 500;
            transition: all 0.2s;
        }

        .empty-state .shop-now-btn:hover {
            background: #d63c32;
        }
        /* Animation */
        @keyframes slideIn {
            from { opacity: 1; transform: none; }
            to { opacity: 1; transform: none; }
        }
        /* Responsive */
        @media (max-width: 767px) {
            .membership-title {
                font-size: 28px;
            }
            .membership-subtitle {
                font-size: 16px;
            }
            .membership-container {
                flex-direction: column;
            }
            .membership-info {
                min-width: 100%;
            }
            .avatar {
                width: 100px;
                height: 100px;
            }
            .transaction-table th, .transaction-table td {
                font-size: 14px;
                padding: 8px;
            }
            canvas#purchaseChart {
                max-height: 200px;
            }
        }
        @media (max-width: 480px) {
            .membership-title {
                font-size: 24px;
            }
            .membership-info h3, .purchase-chart h3, .transaction-history h3 {
                font-size: 20px;
            }
            .transaction-table {
                font-size: 12px;
            }
        }
        /* Hiệu ứng cuộn */
        .membership-info, .purchase-chart, .transaction-history {
            opacity: 1;
            transform: none;
            transition: none;
        }
        .membership-info.visible, .purchase-chart.visible, .transaction-history.visible {
            opacity: 1;
            transform: none;
            transition: none;
        }
        /* Style cho user-info */
        .usermenu li.user-info {
            display: none;
            margin-right: 10px;
        }
        .usermenu li.user-info a {
            color: #000000;
            text-decoration: none;
        }
        .usermenu li.user-info a:hover {
            color: #A63C3C;
        }
        /* Style cho modal */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.5);
        }
        .modal-content {
            background-color: #fff;
            margin: 10% auto;
            padding: 20px;
            border: 1px solid #888;
            width: 80%;
            max-width: 400px;
            border-radius: 10px;
            position: relative;
        }
        .close {
            position: absolute;
            right: 15px;
            top: 10px;
            color: #aaa;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }
        .close:hover,
        .close:focus {
            color: #000;
            text-decoration: none;
        }
        .modal-content h2 {
            text-align: center;
            color: #4A2F1A;
            margin-bottom: 20px;
        }
        .modal-content form {
            display: flex;
            flex-direction: column;
        }
        .modal-content input {
            margin: 10px 0;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
            font-size: 14px;
        }
        .modal-content button {
            padding: 10px;
            background-color: #f7544a;
            color: #fff;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
        }
        .modal-content button:hover {
            background-color: #A63C3C;
        }
        .modal-content .switch-form {
            text-align: center;
            margin-top: 10px;
        }
        .modal-content .switch-form a {
            color: #f7544a;
            text-decoration: none;
        }
        .modal-content .switch-form a:hover {
            text-decoration: underline;
        }
        /* CSS cho loading overlay
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.9);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            transition: opacity 0.5s ease;
        }
        .loading-overlay.hidden {
            opacity: 0;
            pointer-events: none;
        }
        .loading-content {
            text-align: center;
        }
        .loading-logo {
            width: 100px;
            margin-bottom: 20px;
        }
        .loading-spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #f7544a;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        } */
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        /* CSS cho tải lên ảnh đại diện */
        .avatar-upload {
            margin-bottom: 15px;
            text-align: center;
        }
        .avatar-upload label {
            display: block;
            font-size: 16px;
            color: #4A2F1A;
            margin-bottom: 5px;
        }
        .avatar-upload input[type="file"] {
            display: block;
            margin: 0 auto;
            padding: 5px;
            font-size: 14px;
        }
        #avatarPreview {
            display: none;
            width: 100px;
            height: 100px;
            border-radius: 50%;
            margin-top: 10px;
            object-fit: cover;
            border: 2px solid #f7544a;
        }
        /* --- Thêm vào cuối thẻ <style> hoặc trong file CSS chính --- */
        .account-page-layout .row {
            display: flex;
            flex-wrap: wrap;
        }
        .account-sidebar {
            /* background: #FFF5E6; */ /* Xóa màu nền */
            border-radius: 15px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.06);
            padding: 25px 15px 15px 15px;
            min-height: 100%;
            margin-bottom: 30px;
            background: none; /* Đảm bảo không có màu nền */
        }
        .account-menu ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }
        .account-menu ul li {
            margin-bottom: 15px;
        }
        .account-menu ul li a {
            color: #4A2F1A;
            font-size: 16px;
            text-decoration: none;
            display: block;
            padding: 8px 10px;
            border-radius: 6px;
            transition: background 0.2s;
        }
        .account-menu ul li.active a,
        .account-menu ul li a:hover {
            background: #f7544a;
            color: #fff;
        }
        .sidebar-avatar img {
            border: 2px solid #f7544a;
        }
        .account-main-content {
            padding-left: 30px;
            padding-right: 0;
        }
        @media (max-width: 991px) {
            .account-main-content {
                padding-left: 0;
            }
            .account-sidebar {
                margin-bottom: 20px;
            }
            .transaction-table th, .transaction-table td {
                min-width: 90px;
                max-width: 160px;
                font-size: 14px;
            }
            .transaction-history {
                padding: 10px 2px;
            }
        }
        @media (max-width: 767px) {
            .account-page-layout .row {
                flex-direction: column;
            }
            .account-sidebar, .account-main-content {
                padding: 0;
            }
            .transaction-history {
                padding: 5px 0;
            }
            .transaction-table th, .transaction-table td {
                min-width: 80px;
                max-width: 120px;
                font-size: 13px;
                padding: 6px 4px;
            }
            .transaction-table {
                min-width: 600px;
            }
        }
        @media (max-width: 480px) {
            .transaction-table th, .transaction-table td {
                min-width: 70px;
                max-width: 90px;
                font-size: 11px;
                padding: 4px 2px;
            }
            .transaction-table {
                min-width: 400px;
            }
        }
        .account-section {
            display: none;
            opacity: 1;
            transform: none;
            transition: none;
        }
        .account-section.active-section {
            display: block;
            opacity: 1;
            transform: none;
            transition: none;
        }
        @keyframes fadeInTab {
            from { opacity: 1; transform: none; }
            to { opacity: 1; transform: none; }
        }
        .account-menu ul li.active a {
            background: #f7544a;
            color: #fff;
        }
        /* Spinner cho modal */
        .modal-spinner {
            display: inline-block;
            width: 18px;
            height: 18px;
            border: 2.5px solid #fff;
            border-top: 2.5px solid #f7544a;
            border-radius: 50%;
            animation: modalspin 0.7s linear infinite;
            vertical-align: middle;
        }
        @keyframes modalspin {
            0% { transform: rotate(0deg);}
            100% { transform: rotate(360deg);}
        }
        /* Hiệu ứng nút bấm */
        .modal-content button,
        .button {
            transition: transform 0.1s cubic-bezier(.4,0,.2,1), box-shadow 0.1s;
        }
        .modal-content button:active,
        .button:active {
            transform: scale(0.96);
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        }
        /* Style cho modal chỉnh sửa thông tin */
        #editProfileModal .modal-content {
            max-width: 500px;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        #editProfileModal .modal-content h2 {
            color: #4A2F1A;
            font-size: 24px;
            margin-bottom: 25px;
            text-align: center;
            font-weight: 600;
        }

        #editProfileModal .avatar-upload {
            text-align: center;
            margin-bottom: 25px;
            padding: 20px;
            background: #FFF5E6;
            border-radius: 10px;
        }

        #editProfileModal .avatar-upload label {
            display: block;
            font-size: 16px;
            color: #4A2F1A;
            margin-bottom: 15px;
            font-weight: 500;
        }

        #editProfileModal .avatar-upload input[type="file"] {
            display: none;
        }

        #editProfileModal .avatar-upload .upload-btn {
            display: inline-block;
            padding: 10px 20px;
            background: #f7544a;
            color: white;
            border-radius: 5px;
            cursor: pointer;
            transition: background 0.3s;
        }

        #editProfileModal .avatar-upload .upload-btn:hover {
            background: #d63c32;
        }

        #editProfileModal #avatarPreview {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            margin: 15px auto;
            border: 3px solid #f7544a;
            display: block;
            object-fit: cover;
        }

        #editProfileModal .form-group {
            margin-bottom: 20px;
        }

        #editProfileModal .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #4A2F1A;
            font-weight: 500;
        }

        #editProfileModal .form-group input {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s;
        }

        #editProfileModal .form-group input:focus {
            border-color: #f7544a;
            outline: none;
            box-shadow: 0 0 0 2px rgba(247, 84, 74, 0.1);
        }

        #editProfileModal button[type="button"] {
            width: 100%;
            padding: 12px;
            background: #f7544a;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            transition: background 0.3s;
            margin-top: 10px;
        }

        #editProfileModal button[type="button"]:hover {
            background: #d63c32;
        }

        #editProfileModal .close {
            position: absolute;
            right: 20px;
            top: 15px;
            font-size: 24px;
            color: #666;
            cursor: pointer;
            transition: color 0.3s;
        }

        #editProfileModal .close:hover {
            color: #f7544a;
        }

        /* Ẩn avatar và tên ở sidebar trên mobile */
        @media (max-width: 767px) {
          .account-sidebar .sidebar-avatar,
          .account-sidebar #sidebarUserName {
            display: none !important;
          }
          .account-sidebar {
            padding: 0;
            box-shadow: none;
            background: none;
          }
          .account-menu ul {
            display: flex;
            flex-direction: row;
            justify-content: space-between;
            gap: 0;
            margin-bottom: 12px;
          }
          .account-menu ul li {
            margin-bottom: 0;
            flex: 1;
            text-align: center;
          }
          .account-menu ul li a {
            padding: 10px 0;
            font-size: 15px;
            border-radius: 0;
            border-bottom: 2px solid transparent;
            background: none;
          }
          .account-menu ul li.active a {
            background: none;
            color: #f7544a;
            border-bottom: 2px solid #f7544a;
          }
        }

        /* Thu gọn tiêu đề/mô tả trên mobile */
        @media (max-width: 767px) {
          .membership-title, .membership-subtitle {
            font-size: 0;
            margin: 0;
            padding: 0;
            height: 0;
            line-height: 0;
            overflow: hidden;
          }
        }

        /* Tối ưu avatar, thông tin cá nhân, nút chỉnh sửa */
        @media (max-width: 767px) {
          .membership-info {
            max-width: 380px;
            margin: 0 auto 16px auto;
            padding: 16px 12px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.06);
            background: #fff;
          }
          .avatar-container {
            margin-bottom: 8px;
            display: flex;
            flex-direction: column;
            align-items: center;
          }
          .avatar {
            width: 88px;
            height: 88px;
            margin-bottom: 8px;
          }
          .user-details {
            align-items: center;
            margin: 0 auto;
            max-width: 320px;
          }
          .user-details p {
            font-size: 15px;
            margin: 4px 0;
            text-align: center;
          }
          .user-details .edit-btn {
            width: 100%;
            font-size: 16px;
            padding: 12px;
            margin-top: 18px;
            background: #f7544a;
            color: #fff;
            border-radius: 8px;
            font-weight: 500;
            max-width: 320px;
            margin-left: auto;
            margin-right: auto;
            display: block;
          }
          .account-menu ul {
            max-width: 380px;
            margin: 0 auto 12px auto;
            padding: 0 6px;
            justify-content: center;
          }
          .account-menu ul li {
            min-width: 90px;
            text-align: center;
          }
          .account-menu ul li a {
            font-size: 15px;
            padding: 10px 0;
          }
          .account-menu ul li:last-child a {
            max-width: 120px;
            margin-left: 8px;
            margin-right: 0;
            display: inline-block;
          }
          .account-main-content {
            max-width: 420px;
            margin: 0 auto;
            padding-left: 0;
            padding-right: 0;
          }
          .membership-info {
            max-width: 380px;
            margin: 0 auto 16px auto;
            padding: 16px 12px;
          }
          .transaction-history {
            max-width: 420px;
            margin: 0 auto 24px auto;
            overflow-x: auto;
          }
          .transaction-table {
            min-width: 600px;
            max-width: 100%;
            margin: 0 auto;
          }
          .transaction-table th, .transaction-table td {
            min-width: 90px;
            max-width: 160px;
            font-size: 14px;
            padding: 8px 4px;
          }
          .action-buttons {
            min-width: 80px;
          }
        }

        /* Nút đăng xuất nổi bật trên mobile */
        @media (max-width: 767px) {
          .account-menu ul li:last-child a {
            background: #fff0f0;
            color: #f7544a;
            border: 1px solid #f7544a;
            border-radius: 8px;
            margin-top: 8px;
            font-weight: 500;
          }
        }
        @media (max-width: 767px) {
          .account-main-content,
          .transaction-history,
          .membership-info {
            max-width: 100%;
            width: 100%;
            margin: 0 auto 16px auto;
            padding-left: 0;
            padding-right: 0;
          }
          .transaction-table {
            width: 100%;
            min-width: 0;
            max-width: 100%;
            margin: 0;
            table-layout: fixed;
            word-break: break-word;
          }
          .transaction-table th,
          .transaction-table td {
            min-width: 0;
            max-width: none;
            font-size: 13px;
            padding: 6px 2px;
            word-break: break-word;
            white-space: normal;
            overflow-wrap: break-word;
            text-align: center;
          }
          .transaction-table th {
            font-size: 13px;
            padding: 6px 2px;
          }
          .action-buttons {
            min-width: 0;
            display: flex;
            flex-direction: column;
            gap: 4px;
            justify-content: center;
            align-items: center;
          }
          .account-menu ul {
            max-width: 100%;
            width: 100%;
            margin: 0 auto 12px auto;
            padding: 0 2px;
            justify-content: center;
          }
          .account-menu ul li {
            min-width: 0;
            flex: 1 1 0;
          }
          .account-menu ul li a {
            font-size: 14px;
            padding: 8px 0;
          }
          .account-menu ul li:last-child a {
            max-width: 100px;
            margin-left: 4px;
            margin-right: 0;
            display: inline-block;
          }
        }
        @media (max-width: 767px) {
          /* Ẩn cột Sản Phẩm trong bảng lịch sử đặt hàng trên mobile */
          .transaction-table th:nth-child(3),
          .transaction-table td.products {
            display: none;
          }
        }
        @media (max-width: 767px) {
          .user-details, .user-details p {
            word-break: break-word;
            white-space: normal;
            overflow-wrap: break-word;
            max-width: 100%;
          }
          .user-details {
            text-align: center;
            padding: 0 8px;
          }
        }
        @media (max-width: 767px) {
          /* Ẩn nút Đăng Xuất trong tab ngang trên mobile */
          .account-menu ul li:last-child { display: none !important; }
          /* Nút Đăng Xuất lớn dưới cùng */
          .logout-mobile-btn {
            display: block;
            width: 90%;
            max-width: 320px;
            margin: 24px auto 16px auto;
            padding: 14px;
            background: #fff0f0;
            color: #f7544a;
            border: 1px solid #f7544a;
            border-radius: 8px;
            font-size: 17px;
            font-weight: 600;
            text-align: center;
          }
        }
        @media (max-width: 767px) {
          .transaction-table th,
          .transaction-table td {
            word-break: break-all;
            overflow-wrap: anywhere;
            white-space: normal;
            text-align: center;
            padding: 6px 2px;
            font-size: 13px;
            max-width: 1px; /* ép mọi thứ xuống dòng nếu dài */
          }
          .transaction-history,
          .account-main-content,
          .membership-info {
            padding-left: 4px;
            padding-right: 4px;
          }
        }
        @media (max-width: 767px) {
          .transaction-table td:last-child,
          .transaction-table .action-buttons {
            min-height: 32px;
            word-break: break-word;
            white-space: normal;
            text-align: center;
            padding: 4px 2px;
          }
          .transaction-table .action-btn,
          .transaction-table .cancel-btn {
            white-space: normal;
            word-break: break-word;
            padding: 6px 8px;
            font-size: 13px;
          }
        }
    </style>
</head>
<body id="home">
    <!-- Loading Overlay -->
    <div class="loading-overlay">
        <div class="loading-content">
            <img src="images/logo.png" alt="Ấm - Coffee and Cake" class="loading-logo">
            <p>Chờ Ấm Một chút nhé...</p>
            <div class="loading-spinner"></div>
        </div>
    </div>
    <!-- Nội dung trang hiện tại -->
    <div class="wrapper">
        <div class="header">
            <div class="container">
                <div class="row">
                    <div class="col-md-2 col-sm-2">
                        <div class="logo"><a href="index.html"><img src="images/logo.png" alt="Ấm - Coffee and Cake"></a></div>
                    </div>
                    <div class="col-md-10 col-sm-10">
                        <div class="header_top">
                            <div class="row">
                                <div class="col-md-3">
                                    
                                </div>
                                <div class="col-md-6">
                                    <ul class="topmenu">
                                        <li><a href="policy.html">Chính Sách</a></li>
                                        <li><a href="member.html">Thành Viên</a></li>
                                     </ul>
                                </div>
                                <div class="col-md-3">
                                    <ul class="usermenu">
                                        <li id="loginLink"><a href="#" class="log" onclick="openModal('loginModal')"><i class="fa fa-sign-in"></i> Đăng Nhập</a></li>
                                        <li id="registerLink"><a href="#" class="reg" onclick="openModal('registerModal')"><i class="fa fa-user-plus"></i> Đăng Ký</a></li>
                                        <li class="user-info"><a href="#" id="logoutLink"><i class="fa fa-sign-out"></i> Đăng Xuất</a></li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                        <div class="clearfix"></div>
                        <div class="header_bottom">
                            <ul class="option">
                                <li id="search" class="search">
                                    <form><input class="search-submit" type="submit" value=""><input class="search-input" placeholder="Tìm kiếm đồ uống, bánh ngọt..." type="text" value="" name="search"></form>
                                </li>
                                <li class="option-cart">
                                    <a href="cart.html" class="cart-icon">Giỏ Hàng <span class="cart_no">02</span></a>
                                </li>
                            </ul>
                            <div class="navbar-header"><button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse"><span class="sr-only">Toggle navigation</span><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></button></div>
                            <div class="navbar-collapse collapse">
                                <ul class="nav navbar-nav">
                                    <li>
                                        <a href="index.html">Trang Chủ</a>
                                    </li>
                                    <li><a href="menu.html">Menu</a></li>
                                    <li><a href="news.html">Tin Tức, Khuyến Mãi & Sự Kiện</a></li>
                                    <li><a href="about.html">Về Chúng Tôi</a></li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="clearfix"></div>
        <div class="hom-slider">
            <div class="container">
                <div id="sequence">
                    <div class="sequence-prev"><i class="fa fa-angle-left"></i></div>
                    <div class="sequence-next"><i class="fa fa-angle-right"></i></div>
                    <ul class="sequence-canvas">
                        <li class="animate-in">
                            <div class="flat-caption caption1 formLeft delay300 text-center"><span class="suphead">Ấm - Coffee and Cake</span></div>
                            <div class="flat-caption caption2 formLeft delay400 text-center">
                                <h1>Chào Mừng Đến Với Không Gian Ấm Áp</h1>
                            </div>
                            <div class="flat-button caption4 formLeft delay600 text-center"><a class="more" href="menu-drinks.html">Xem Menu</a></div>
                            <div class="flat-image formBottom delay200" data-duration="5" data-bottom="true"><img src="images/khonggian.png" alt=""></div>
                        </li>
                        <li>
                            <div class="flat-caption caption2 formLeft delay400">
                                <h1>Khuyến Mãi Đặc Biệt</h1>
                            </div>   
                            <div class="flat-caption caption3 formLeft delay500">
                                <h2>Mua 1 tặng 1 cho tất cả đồ uống<br>Chỉ trong tuần này!</h2>
                            </div>
                            <div class="flat-button caption5 formLeft delay600"><a class="more" href="promotions.html">Xem Chi Tiết</a></div>
                            <div class="flat-image formBottom delay200" data-bottom="true"><img src="images/khuyenmai.png" alt=""></div>
                        </li>
                        <li>
                            <div class="flat-caption caption2 formLeft delay400 text-center">
                                <h1>Bánh Ngọt Tươi Mới</h1>
                            </div>
                            <div class="flat-caption caption3 formLeft delay500 text-center">
                                <p>Khám phá bộ sưu tập bánh ngọt mới nhất của chúng tôi<br>Được làm thủ công mỗi ngày!</p>
                            </div>
                            <div class="flat-button caption4 formLeft delay600 text-center"><a class="more" href="menu-cakes.html">Thử Ngay</a></div>
                            <div class="flat-image formBottom delay200" data-bottom="true"><img src="images/banhngot.png" alt=""></div>
                        </li>
                    </ul>
                </div>
            </div>
            <div class="promotion-banner">
                <div class="container">
                    <div class="row">
                        <div class="col-md-4 col-sm-4 col-xs-4">
                            <div class="promo-box"><a href="event.html"><img src="images/promotion-01.png" alt="Cà Phê"></a></div>
                         </div>
                         <div class="col-md-4 col-sm-4 col-xs-4">
                            <div class="promo-box"><a href="event.html"><img src="images/promotion-02.png" alt="Bánh Ngọt"></a></div>
                         </div>
                         <div class="col-md-4 col-sm-4 col-xs-4">
                            <div class="promo-box"><a href="event.html"><img src="images/promotion-03.png" alt="Khuyến Mãi"></a></div>
                         </div>
                    </div>
                </div>
            </div>
        </div>  
        <div class="clearfix"></div>
        <div class="container_fullwidth">
            <div class="container">
                <div class="membership-section account-page-layout">
                    <div class="row">
                        <!-- Sidebar tài khoản -->
                        <div class="col-md-3 col-sm-12 account-sidebar">
                            <div class="account-menu">
                                <div class="sidebar-avatar text-center">
                                    <img src="images/nguoidung.png" alt="Avatar" class="avatar" id="sidebarAvatar" style="width:80px;height:80px;margin-bottom:10px;">
                                    <div style="font-weight:600;margin-bottom:5px;" id="sidebarUserName">Chưa đăng nhập</div>
                                </div>
                                <ul>
                                    <li class="active"><a href="#" data-section="profileSection">Thông Tin Cá Nhân</a></li>
                                    <li><a href="#" data-section="chartSection">Thống Kê Mua Hàng</a></li>
                                    <li><a href="#" data-section="ordersSection">Lịch Sử Đặt Hàng</a></li>
                                    <li><a href="#" id="sidebarLogout">Đăng Xuất</a></li>
                                </ul>
                            </div>
                        </div>
                        <!-- Nội dung chính -->
                        <div class="col-md-9 col-sm-12 account-main-content">
                            <h2 class="membership-title">Thông Tin Thành Viên</h2>
                            <p class="membership-subtitle">Xem thông tin cá nhân và lịch sử mua sắm của bạn tại Ấm - Coffee and Cake!</p>
                            <div id="profileSection" class="account-section active-section">
                                <div class="membership-container">
                                    <div class="membership-info">
                                        <div class="avatar-container">
                                            <img src="images/nguoidung.png" alt="Avatar" class="avatar" id="profileAvatar"/>
                                        </div>
                                        <div class="user-details">
                                            <p><strong>Họ và Tên:</strong> <span id="userName">Chưa đăng nhập</span></p>
                                            <p><strong>Email:</strong> <span id="userEmail">Chưa đăng nhập</span></p>
                                            <p><strong>Số Điện Thoại:</strong> <span id="userPhone">Chưa đăng nhập</span></p>
                                            <p><strong>Địa Chỉ:</strong> <span id="userAddress">Chưa có địa chỉ</span></p>
                                            <button class="edit-btn" onclick="openEditModal()">Chỉnh Sửa Thông Tin</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div id="chartSection" class="account-section" style="display:none;">
                                <div class="purchase-chart">
                                    <canvas id="purchaseChart"></canvas>
                                </div>
                            </div>
                            <div id="ordersSection" class="account-section" style="display:none;">
                                <div class="transaction-history">
                                    <h3>
                                        <!-- <button class="filter-btn">
                                            <i class="fa fa-filter"></i> Lọc
                                        </button> -->
                                    </h3>
                                    <table class="transaction-table" id="transactionTable">
                                        <thead>
                                            <tr>
                                                <th>Mã Đơn</th>
                                                <th>Ngày Đặt</th>
                                                <th>Sản Phẩm</th>
                                                <th>Tổng Tiền</th>
                                                <th>Trạng Thái</th>
                                                <th>Thao Tác</th>
                                            </tr>
                                        </thead>
                                        <tbody id="transactionTableBody">
                                            <!-- Dữ liệu sẽ được thêm bằng JavaScript -->
                                        </tbody>
                                    </table>
                                    <div class="pagination-container">
                                        <div class="pagination-info">Hiển thị 1-5 trong tổng số 10 đơn hàng</div>
                                    <div class="pagination">
                                            <button onclick="prevPage()" id="prevBtn" disabled>
                                                <i class="fa fa-chevron-left"></i>
                                            </button>
                                            <span class="page-number">Trang 1/2</span>
                                            <button onclick="nextPage()" id="nextBtn">
                                                <i class="fa fa-chevron-right"></i>
                                            </button>
                                    </div>
                                    </div>
                                    <!-- Empty state -->
                                    <div class="empty-state" style="display: none;">
                                        <img src="images/dathang.jpg" alt="Không có đơn hàng">
                                        <h4>Chưa có đơn hàng nào</h4>
                                        <p>Hãy đặt món yêu thích của bạn ngay hôm nay!</p>
                                        <a href="menu.html" class="shop-now-btn">Đặt Hàng Ngay</a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="clearfix"></div>
                <!-- <div class="our-brand">
                    <h3 class="title"><strong>Đối Tác </strong> Của Chúng Tôi</h3>
                    <ul id="braldLogo">
                        <li>
                            <ul class="brand_item">
                                <li>
                                    <a href="#">
                                        <div class="brand-logo"><img src="images/Highlands_Coffee_logo.svg.png" alt=""></div>
                                    </a>
                                </li>
                                <li>
                                    <a href="#">
                                        <div class="brand-logo"><img src="images/logo-phuc-long-coffee-and-tea-300x225.webp" alt=""></div>
                                    </a>
                                </li>
                                <li>
                                    <a href="#">
                                        <div class="brand-logo"><img src="images/Starbucks_Corporation_Logo_2011.svg.png" alt=""></div>
                                    </a>
                                </li>
                                <li>
                                    <a href="#">
                                        <div class="brand-logo"><img src="images/TOUSlesJOURSnewlogo.jpg" alt=""></div>
                                    </a>
                                </li>
                                <li>
                                    <a href="#">
                                        <div class="brand-logo"><img src="images/vina.jpg" alt=""></div>
                                    </a>
                                </li>
                            </ul>
                        </li>
                    </ul>
                </div> -->
            </div>
        </div>
        <div class="clearfix"></div>
        <div class="footer">
            <div class="footer-info">
                <div class="container">
                    <div class="row">
                        <div class="col-md-3">
                            <div class="footer-logo"><a href="index.html"><img src="images/LOGO.png" alt="Ấm - Coffee and Cake"/></a></div>
                        </div>
                        <div class="col-md-3 col-sm-6">
                            <h4 class="title">Thông Tin <strong>Liên Hệ</strong></h4>
                            <p>Số 123, Nguyễn Trãi, Quận 5, TP. Hồ Chí Minh</p>
                            <p>Hotline: (028) 1234 5678</p>
                            <p>Email: contact@amcoffee.vn</p>
                        </div>
                        <div class="col-md-3 col-sm-6">
                            <h4 class="title">Hỗ Trợ <strong>Khách Hàng</strong></h4>
                            <ul class="support">
                                <li><a href="policy.html#faq">Câu Hỏi Thường Gặp</a></li>
                                <li><a href="policy.html#payment">Phương Thức Thanh Toán</a></li>
                                <li><a href="policy.html#delivery">Giao Hàng</a></li>
                                <li><a href="policy.html#returns">Đổi Trả</a></li>
                                <li><a href="policy.html#support">Hỗ Trợ Khách Hàng</a></li>
                            </ul>
                        </div>
                        <div class="col-md-3">
                            <h4 class="title">Đăng Ký <strong>Bản Tin</strong></h4>
                            <p>Nhận ưu đãi và tin tức mới nhất từ Ấm!</p>
                            <form class="newsletter">
                                <input type="email" name="email" placeholder="Nhập email của bạn..."/>
                                <input type="submit" value="Đăng Ký" class="button"/>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
            <div class="copyright-info">
                <div class="container">
                    <div class="row">
                        <div class="col-md-6">
                            <p>Copyright © 2025. Thiết kế bởi <a href="#">Ấm - Coffee and Cake</a>. Bản quyền thuộc về chúng tôi.</p>
                        </div>
                        <div class="col-md-6">
                            <ul class="social-icon2">
                                <li><a href="#" class="facebook"><i class="fa fa-facebook"></i></a></li>
                                <li><a href="#" class="instagram"><i class="fa fa-instagram"></i></a></li>
                                <li><a href="#" class="youtube"><i class="fa fa-youtube"></i></a></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- Modals -->
        <div id="loginModal" class="modal">
            <div class="modal-content">
                <span class="close" onclick="closeModal('loginModal')">×</span>
                <h2>Đăng Nhập</h2>
                <form>
                    <input type="email" id="loginEmail" placeholder="Email" required>
                    <input type="password" id="loginPassword" placeholder="Mật khẩu" required>
                    <button type="button" id="loginBtn" onclick="handleLogin()">
                        Đăng Nhập
                        <span class="modal-spinner" id="loginSpinner" style="display:none;margin-left:8px;"></span>
                    </button>
                </form>
                <div class="switch-form">
                    <p>Chưa có tài khoản? <a href="#" onclick="switchToRegister()">Đăng Ký</a></p>
                    <p><a href="#" onclick="switchToForgotPassword()">Quên mật khẩu?</a></p>
                </div>
            </div>
        </div>
        <div id="registerModal" class="modal">
            <div class="modal-content">
                <span class="close" onclick="closeModal('registerModal')">×</span>
                <h2>Đăng Ký</h2>
                <form>
                    <input type="text" id="registerName" placeholder="Họ và Tên" required>
                    <input type="email" id="registerEmail" placeholder="Email" required>
                    <input type="password" id="registerPassword" placeholder="Mật khẩu (ít nhất 8 ký tự)" required>
                    <button type="button" id="registerBtn" onclick="handleRegister()">
                        Đăng Ký
                        <span class="modal-spinner" id="registerSpinner" style="display:none;margin-left:8px;"></span>
                    </button>
                </form>
                <div class="switch-form">
                    <p>Đã có tài khoản? <a href="#" onclick="switchToLogin()">Đăng Nhập</a></p>
                </div>
            </div>
        </div>
        <div id="forgotPasswordModal" class="modal">
            <div class="modal-content">
                <span class="close" onclick="closeModal('forgotPasswordModal')">×</span>
                <h2>Quên Mật Khẩu</h2>
                <form>
                    <input type="email" id="forgotPasswordEmail" placeholder="Nhập email của bạn" required>
                    <button type="button" id="forgotBtn" onclick="handleForgotPassword()">
                        Gửi Email Đặt Lại
                        <span class="modal-spinner" id="forgotSpinner" style="display:none;margin-left:8px;"></span>
                    </button>
                </form>
                <div class="switch-form">
                    <p>Quay lại <a href="#" onclick="switchToLogin()">Đăng Nhập</a></p>
                </div>
            </div>
        </div>
        <div id="editProfileModal" class="modal">
            <div class="modal-content">
                <span class="close" onclick="closeModal('editProfileModal')">×</span>
                <h2>Chỉnh Sửa Thông Tin</h2>
                <form>
                    <div class="avatar-upload">
                        <label for="editAvatar">Hình Đại Diện</label>
                        <label for="editAvatar" class="upload-btn">
                            <i class="fa fa-upload"></i> Chọn ảnh
                        </label>
                        <input type="file" id="editAvatar" accept="image/*">
                        <img id="avatarPreview" src="" alt="Avatar Preview">
                    </div>
                    <div class="form-group">
                        <label for="editName">Họ và Tên</label>
                        <input type="text" id="editName" placeholder="Nhập họ và tên của bạn" required>
                    </div>
                    <div class="form-group">
                        <label for="editEmail">Email</label>
                        <input type="email" id="editEmail" placeholder="Nhập email của bạn" required>
                    </div>
                    <div class="form-group">
                        <label for="editPhone">Số Điện Thoại</label>
                        <input type="text" id="editPhone" placeholder="Nhập số điện thoại của bạn">
                    </div>
                    <div class="form-group">
                        <label for="editAddress">Địa Chỉ</label>
                        <input type="text" id="editAddress" placeholder="Nhập địa chỉ của bạn">
                    </div>
                    <button type="button" onclick="handleEditProfile()">
                        <i class="fa fa-save"></i> Lưu Thay Đổi
                    </button>
                </form>
            </div>
        </div>
    </div>
    <!-- Bootstrap core JavaScript -->
    <script type="text/javascript" src="js/jquery-1.10.2.min.js"></script>
    <script type="text/javascript" src="js/jquery.easing.1.3.js"></script>
    <script type="text/javascript" src="js/bootstrap.min.js"></script>
    <script type="text/javascript" src="js/jquery.sequence-min.js"></script>
    <script type="text/javascript" src="js/jquery.carouFredSel-6.2.1-packed.js"></script>
    <script defer src="js/jquery.flexslider.js"></script>
    <script type="text/javascript" src="js/script.min.js"></script>
    <script type="module">
        // Import Firebase SDK
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
        import { getAuth, onAuthStateChanged, signOut, signInWithEmailAndPassword, createUserWithEmailAndPassword, sendPasswordResetEmail, updateEmail, updateProfile } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
        import { getDatabase, ref, onValue, update, query, orderByChild, equalTo, set } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";
        import { getStorage, ref as storageRef, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-storage.js";

        // Firebase Config
        const firebaseConfig = {
            apiKey: "AIzaSyA5NhPnsfXEUbXYzkdB5kvfaE0swtViJaI",
            authDomain: "coffee-and-cake-e2f5d.firebaseapp.com",
            databaseURL: "https://coffee-and-cake-e2f5d-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "coffee-and-cake-e2f5d",
            storageBucket: "coffee-and-cake-e2f5d.firebasestorage.app",
            messagingSenderId: "453243002159",
            appId: "1:453243002159:web:074baa5652ed789ecbd5da",
            measurementId: "G-1H7DM8MQCV"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const database = getDatabase(app);
        const storage = getStorage(app);

        // Pagination Variables
        let orders = [];
        const itemsPerPage = 5;
        let currentPage = 1;

        // Map Firebase status to display status
        const statusMap = {
            'pending': 'Đang xử lý',
            'confirmed': 'Đã xác nhận', 
            'shipped': 'Đang giao',
            'delivered': 'Đã giao',
            'cancelled': 'Hủy',
            'processing': 'Đang xử lý',
            'paid': 'Đã thanh toán'
        };

        // Display Orders với cải thiện hiển thị
        function displayTransactions(page) {
            const start = (page - 1) * itemsPerPage;
            const end = start + itemsPerPage;
            const paginatedOrders = orders.slice(start, end);

            const tbody = document.getElementById('transactionTableBody');
            const emptyState = document.querySelector('.empty-state');
            const tableContainer = document.querySelector('.transaction-table');
            const paginationContainer = document.querySelector('.pagination-container');
            
            if (orders.length === 0) {
                // Hiển thị empty state
                emptyState.style.display = 'block';
                tableContainer.style.display = 'none';
                paginationContainer.style.display = 'none';
                return;
            }

            // Ẩn empty state và hiện bảng
            emptyState.style.display = 'none';
            tableContainer.style.display = 'table';
            paginationContainer.style.display = 'flex';
            
            tbody.innerHTML = '';
            
            paginatedOrders.forEach(order => {
                // Format mã đơn hàng
                const orderId = order.id.slice(-8).toUpperCase(); // Lấy 8 ký tự cuối
                
                // Format ngày giờ
                const orderDate = new Date(order.createdAt);
                const formattedDate = orderDate.toLocaleDateString('vi-VN', {
                        day: '2-digit',
                        month: '2-digit', 
                    year: 'numeric'
                });
                const formattedTime = orderDate.toLocaleTimeString('vi-VN', {
                        hour: '2-digit',
                        minute: '2-digit'
                    });

                // Xử lý danh sách sản phẩm
                const productsList = order.items && order.items.length > 0
                    ? order.items.map(item => {
                        const quantity = item.quantity || 1;
                        const name = item.name || 'Sản phẩm không xác định';
                        const image = item.image || '../images/default-product.png';
                        console.log('Product item:', { name, quantity, image }); // Debug log
                        return `
                            <div class="product-item">
                                <img src="${image}" alt="${name}" class="product-image">
                                <div class="product-info">
                                    <div class="product-name">${name}</div>
                                    <div class="product-quantity">x${quantity}</div>
                                </div>
                            </div>`;
                    }).join('')
                    : '<div class="product-item">Không có sản phẩm</div>';

                // Xử lý trạng thái
                const status = order.status || 'pending';
                const statusDisplay = {
                    'pending': { text: 'Đang xử lý', class: 'status-pending' },
                    'processing': { text: 'Đang xử lý', class: 'status-processing' },
                    'confirmed': { text: 'Đã xác nhận', class: 'status-processing' },
                    'shipped': { text: 'Đang giao', class: 'status-shipped' },
                    'delivered': { text: 'Đã giao', class: 'status-delivered' },
                    'cancelled': { text: 'Đã hủy', class: 'status-cancelled' }
                }[status] || { text: 'Không xác định', class: '' };

                // Xử lý nút hành động
                const actionButtons = `
                    <div class="action-buttons">
                        <button class="action-btn view-btn" onclick="viewOrder('${order.id}')">
                            <i class="fa fa-eye"></i> Xem
                        </button>
                        ${(status === 'pending' || status === 'processing') ? 
                            `<button class="action-btn cancel-btn" onclick="cancelOrder('${order.id}')">
                                <i class="fa fa-times"></i> Hủy
                            </button>` : ''}
                    </div>`;

                const row = `
                    <tr>
                        <td class="order-id">#${orderId}</td>
                        <td>${formattedDate}<br><small style="color:#666">${formattedTime}</small></td>
                        <td class="products">${productsList}</td>
                        <td class="total-amount">${(order.grandTotal || 0).toLocaleString('vi-VN')}đ</td>
                        <td><span class="status-badge ${statusDisplay.class}">${statusDisplay.text}</span></td>
                        <td>${actionButtons}</td>
                    </tr>
                `;
                tbody.innerHTML += row;
            });

            // Cập nhật thông tin phân trang
            const totalOrders = orders.length;
            const totalPages = Math.ceil(totalOrders / itemsPerPage);
            const startItem = start + 1;
            const endItem = Math.min(end, totalOrders);
            
            document.querySelector('.pagination-info').textContent = 
                `Hiển thị ${startItem}-${endItem} trong tổng số ${totalOrders} đơn hàng`;
            document.querySelector('.page-number').textContent = `Trang ${page}/${totalPages}`;
            
            // Cập nhật trạng thái nút phân trang
            document.getElementById('prevBtn').disabled = page === 1;
            document.getElementById('nextBtn').disabled = end >= totalOrders;
        }

        // Thêm hàm xem chi tiết đơn hàng
        window.viewOrder = function(orderId) {
            const order = orders.find(o => o.id === orderId);
            if (!order) return;

            // Tạo nội dung chi tiết đơn hàng
            const orderDate = new Date(order.createdAt);
            const formattedDate = orderDate.toLocaleDateString('vi-VN', {
                day: '2-digit',
                month: '2-digit',
                year: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });

            const productsList = order.items?.map(item => `
                <div style="display:flex;align-items:center;margin-bottom:10px;padding:10px;background:#f8f9fa;border-radius:8px;">
                    <img src="${item.image || '../images/default-product.png'}" 
                         style="width:50px;height:50px;object-fit:cover;border-radius:6px;margin-right:15px;">
                    <div style="flex:1">
                        <div style="font-weight:500;color:#333;margin-bottom:4px;">${item.name}</div>
                        <div style="color:#666;font-size:13px;">
                            ${item.quantity}x × ${(item.price || 0).toLocaleString('vi-VN')}đ
                        </div>
                    </div>
                    <div style="font-weight:600;color:#f7544a;">
                        ${((item.price || 0) * (item.quantity || 1)).toLocaleString('vi-VN')}đ
                    </div>
                </div>
            `).join('') || 'Không có sản phẩm';

            const statusDisplay = {
                'pending': { text: 'Đang xử lý', color: '#ffc107' },
                'processing': { text: 'Đang xử lý', color: '#2196f3' },
                'confirmed': { text: 'Đã xác nhận', color: '#2196f3' },
                'shipped': { text: 'Đang giao', color: '#4caf50' },
                'delivered': { text: 'Đã giao', color: '#00c853' },
                'cancelled': { text: 'Đã hủy', color: '#ef4444' }
            }[order.status || 'pending'] || { text: 'Không xác định', color: '#6c757d' };

            Swal.fire({
                title: `Chi tiết đơn hàng #${order.id.slice(-8).toUpperCase()}`,
                html: `
                    <div style="text-align:left;max-height:70vh;overflow-y:auto;padding:0 10px;">
                        <div style="margin-bottom:20px;padding-bottom:15px;border-bottom:1px solid #eee;">
                            <div style="color:#666;margin-bottom:5px;">Ngày đặt hàng</div>
                            <div style="font-weight:500;">${formattedDate}</div>
                        </div>
                        
                        <div style="margin-bottom:20px;padding-bottom:15px;border-bottom:1px solid #eee;">
                            <div style="color:#666;margin-bottom:5px;">Trạng thái</div>
                            <div style="font-weight:500;color:${statusDisplay.color};">
                                ${statusDisplay.text}
                            </div>
                        </div>

                        <div style="margin-bottom:20px;padding-bottom:15px;border-bottom:1px solid #eee;">
                            <div style="color:#666;margin-bottom:5px;">Địa chỉ giao hàng</div>
                            <div style="font-weight:500;">
                                ${order.shippingInfo?.address || 'Chưa có địa chỉ'}
                            </div>
                        </div>

                        <div style="margin-bottom:20px;">
                            <div style="color:#666;margin-bottom:10px;">Sản phẩm đã đặt</div>
                            ${productsList}
                        </div>

                        <div style="margin-top:20px;padding-top:15px;border-top:1px solid #eee;">
                            <div style="display:flex;justify-content:space-between;margin-bottom:8px;">
                                <div style="color:#666;">Tạm tính</div>
                                <div>${(order.subtotal || 0).toLocaleString('vi-VN')}đ</div>
                            </div>
                            <div style="display:flex;justify-content:space-between;margin-bottom:8px;">
                                <div style="color:#666;">Phí vận chuyển</div>
                                <div>${(order.shippingFee || 0).toLocaleString('vi-VN')}đ</div>
                            </div>
                            ${order.discountAmount ? `
                            <div class="d-flex justify-content-between mb-2">
                                <span class="text-muted">
                                    ${order.couponCode ? `Mã giảm giá (${order.couponCode}):` : 'Giảm giá:'}
                                </span>
                                <span class="text-danger">-${order.discountAmount.toLocaleString('vi-VN')}đ</span>
                            </div>
                            ` : ''}
                            <div style="display:flex;justify-content:space-between;margin-top:15px;padding-top:15px;border-top:1px dashed #eee;">
                                <div style="font-weight:600;font-size:16px;">Tổng cộng</div>
                                <div style="font-weight:600;font-size:16px;color:#f7544a;">
                                    ${(order.grandTotal || 0).toLocaleString('vi-VN')}đ
                                </div>
                            </div>
                        </div>
                    </div>
                `,
                width: 600,
                showCloseButton: true,
                showConfirmButton: false,
                showCancelButton: true,
                cancelButtonText: 'Đóng',
                cancelButtonColor: '#6B7280'
            });
        };

        // Cập nhật hàm hủy đơn hàng
        window.cancelOrder = function(orderId) {
            Swal.fire({
                title: 'Hủy đơn hàng?',
                text: 'Bạn có chắc muốn hủy đơn hàng này không?',
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#ef4444',
                cancelButtonColor: '#6B7280',
                confirmButtonText: 'Hủy đơn hàng',
                cancelButtonText: 'Đóng',
                showClass: {
                    popup: 'animate__animated animate__fadeInDown'
                },
                hideClass: {
                    popup: 'animate__animated animate__fadeOutUp'
                }
            }).then((result) => {
                if (result.isConfirmed) {
                    const orderRef = ref(database, `orders/${orderId}`);
                    update(orderRef, { 
                        status: 'cancelled',
                        cancelledAt: new Date().toISOString()
                    }).then(() => {
                        Swal.fire({
                            icon: 'success',
                            title: 'Đã hủy đơn hàng',
                            text: 'Đơn hàng của bạn đã được hủy thành công',
                            timer: 1500,
                            showConfirmButton: false
                        });
                    }).catch(error => {
                        Swal.fire({
                            icon: 'error',
                            title: 'Lỗi!',
                            text: `Không thể hủy đơn hàng: ${error.message}`,
                            confirmButtonColor: '#ef4444'
                        });
                    });
                }
            });
        };

        // Pagination Functions
        window.prevPage = function() {
            if (currentPage > 1) {
                currentPage--;
                displayTransactions(currentPage);
            }
        };

        window.nextPage = function() {
            if (currentPage < Math.ceil(orders.length / itemsPerPage)) {
                currentPage++;
                displayTransactions(currentPage);
            }
        };

        // Preview avatar when selected
        document.getElementById('editAvatar').addEventListener('change', (event) => {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    const preview = document.getElementById('avatarPreview');
                    preview.src = e.target.result;
                    preview.style.display = 'block';
                };
                reader.readAsDataURL(file);
            }
        });

        // Open Edit Profile Modal
        window.openEditModal = function() {
            const user = auth.currentUser;
            if (user) {
                const userRef = ref(database, `users/${user.uid}`);
                onValue(userRef, (snapshot) => {
                    const data = snapshot.val();
                    if (data) {
                        document.getElementById('editName').value = data.name || '';
                        document.getElementById('editEmail').value = data.email || user.email || '';
                        document.getElementById('editPhone').value = data.phone || '';
                        document.getElementById('editAddress').value = data.address || '';
                        const preview = document.getElementById('avatarPreview');
                        if (data.avatarUrl) {
                            preview.src = data.avatarUrl;
                            preview.style.display = 'block';
                        } else {
                            preview.src = '';
                            preview.style.display = 'none';
                        }
                    } else {
                        document.getElementById('editName').value = user.displayName || '';
                        document.getElementById('editEmail').value = user.email || '';
                        document.getElementById('editPhone').value = '';
                        document.getElementById('editAddress').value = '';
                        document.getElementById('avatarPreview').style.display = 'none';
                    }
                }, (error) => {
                    Swal.fire({
                        icon: 'error',
                        title: 'Lỗi!',
                        text: `Không thể tải thông tin: ${error.message}`,
                        showConfirmButton: true
                    });
                });
                document.getElementById('editProfileModal').style.display = 'block';
            }
        };

        // Handle Edit Profile
        window.handleEditProfile = async function() {
            const user = auth.currentUser;
            if (user) {
                const newName = document.getElementById('editName').value;
                const newEmail = document.getElementById('editEmail').value;
                const newPhone = document.getElementById('editPhone').value;
                const newAddress = document.getElementById('editAddress').value;
                const avatarFile = document.getElementById('editAvatar').files[0];

                try {
                    // Validate file size (max 1MB for base64)
                    if (avatarFile && avatarFile.size > 1 * 1024 * 1024) {
                        throw new Error('Kích thước ảnh không được vượt quá 1MB');
                    }

                    // Validate file type
                    if (avatarFile && !['image/jpeg', 'image/png', 'image/gif'].includes(avatarFile.type)) {
                        throw new Error('Chỉ chấp nhận file ảnh (JPEG, PNG, GIF)');
                    }

                    // Update email and profile name
                    await updateEmail(user, newEmail);
                    await updateProfile(user, { displayName: newName });

                    const userData = {
                        name: newName,
                        email: newEmail,
                        phone: newPhone,
                        address: newAddress
                    };

                    // Handle avatar upload
                    if (avatarFile) {
                        try {
                            // Convert image to base64
                            const reader = new FileReader();
                            reader.readAsDataURL(avatarFile);
                            
                            await new Promise((resolve, reject) => {
                                reader.onload = () => {
                                    // Compress image if needed
                                    const img = new Image();
                                    img.src = reader.result;
                                    img.onload = () => {
                                        const canvas = document.createElement('canvas');
                                        const MAX_WIDTH = 200;
                                        const MAX_HEIGHT = 200;
                                        let width = img.width;
                                        let height = img.height;
                                        
                                        if (width > height) {
                                            if (width > MAX_WIDTH) {
                                                height *= MAX_WIDTH / width;
                                                width = MAX_WIDTH;
                                            }
                                        } else {
                                            if (height > MAX_HEIGHT) {
                                                width *= MAX_HEIGHT / height;
                                                height = MAX_HEIGHT;
                                            }
                                        }
                                        
                                        canvas.width = width;
                                        canvas.height = height;
                                        const ctx = canvas.getContext('2d');
                                        ctx.drawImage(img, 0, 0, width, height);
                                        
                                        // Convert to base64 with reduced quality
                                        const base64String = canvas.toDataURL('image/jpeg', 0.7);
                                        userData.avatarUrl = base64String;
                                        resolve();
                                    };
                                    img.onerror = reject;
                                };
                                reader.onerror = reject;
                            });
                        } catch (uploadError) {
                            console.error('Avatar conversion error:', uploadError);
                            throw new Error('Không thể xử lý ảnh đại diện');
                        }
                    }

                    // Update user data in database
                    const userRef = ref(database, `users/${user.uid}`);
                    await update(userRef, userData);

                    // Update UI
                    document.getElementById('userName').textContent = newName || "Người dùng chưa đặt tên";
                    document.getElementById('userEmail').textContent = newEmail || "Chưa có email";
                    document.getElementById('userPhone').textContent = newPhone || "Chưa có số điện thoại";
                    document.getElementById('userAddress').textContent = newAddress || "Chưa có địa chỉ";
                    
                    // Update avatar images
                    if (userData.avatarUrl) {
                        document.querySelector('.avatar').src = userData.avatarUrl;
                        document.getElementById('sidebarAvatar').src = userData.avatarUrl;
                        document.getElementById('profileAvatar').src = userData.avatarUrl;
                    }

                    Swal.fire({
                        icon: 'success',
                        title: 'Cập nhật thành công!',
                        timer: 1500,
                        showConfirmButton: false
                    }).then(() => {
                        closeModal('editProfileModal');
                    });
                } catch (error) {
                    console.error('Profile update error:', error);
                    Swal.fire({
                        icon: 'error',
                        title: 'Lỗi!',
                        text: error.message || 'Không thể cập nhật thông tin',
                        showConfirmButton: true
                    });
                }
            }
        };

        // Check Auth State and Load Data
        onAuthStateChanged(auth, (user) => {
            const logoutLink = document.getElementById('logoutLink');
            const loginLink = document.getElementById('loginLink');
            const registerLink = document.getElementById('registerLink');
            const userInfo = document.querySelector('.user-info');
            const userNameElement = document.getElementById('userName');
            const userEmailElement = document.getElementById('userEmail');
            const userPhoneElement = document.getElementById('userPhone');
            const userAddressElement = document.getElementById('userAddress');
            const avatarElement = document.querySelector('.avatar');
            const sidebarAvatar = document.getElementById('sidebarAvatar');
            const sidebarUserName = document.getElementById('sidebarUserName');
            const profileAvatar = document.getElementById('profileAvatar');

            if (user) {
                userInfo.style.display = 'inline-block';
                loginLink.style.display = 'none';
                registerLink.style.display = 'none';

                // Load user info
                const userRef = ref(database, `users/${user.uid}`);
                onValue(userRef, (snapshot) => {
                    const data = snapshot.val();
                    if (data) {
                        userNameElement.textContent = data.name || "Người dùng chưa đặt tên";
                        userEmailElement.textContent = data.email || user.email || "Chưa có email";
                        userPhoneElement.textContent = data.phone || "Chưa có số điện thoại";
                        userAddressElement.textContent = data.address || "Chưa có địa chỉ";
                        const avatarUrl = data.avatarUrl || "images/nguoidung.png";
                        avatarElement.src = avatarUrl;
                        sidebarAvatar.src = avatarUrl;
                        profileAvatar.src = avatarUrl;
                        sidebarUserName.textContent = data.name || user.displayName || "Người dùng";
                    } else {
                        userNameElement.textContent = user.displayName || "Người dùng chưa đặt tên";
                        userEmailElement.textContent = user.email || "Chưa có email";
                        userPhoneElement.textContent = "Chưa có số điện thoại";
                        userAddressElement.textContent = "Chưa có địa chỉ";
                        const defaultAvatar = "images/nguoidung.png";
                        avatarElement.src = defaultAvatar;
                        sidebarAvatar.src = defaultAvatar;
                        profileAvatar.src = defaultAvatar;
                        sidebarUserName.textContent = user.displayName || "Người dùng";
                    }
                }, (error) => {
                    Swal.fire({
                        icon: 'error',
                        title: 'Lỗi!',
                        text: `Không thể tải thông tin người dùng: ${error.message}`,
                        showConfirmButton: true
                    });
                });

                // Load orders với cải thiện xử lý dữ liệu
                const ordersRef = query(ref(database, 'orders'), orderByChild('userId'), equalTo(user.uid));
                onValue(ordersRef, (snapshot) => {
                    const data = snapshot.val();
                    console.log('Loaded orders data:', data);
                    
                    if (data) {
                        // Chuyển đổi object thành array và thêm id
                        orders = Object.entries(data).map(([id, order]) => ({
                            id,
                            ...order
                        }));

                        // Sắp xếp theo thời gian tạo (mới nhất trước)
                        orders.sort((a, b) => {
                            const dateA = new Date(a.createdAt || 0);
                            const dateB = new Date(b.createdAt || 0);
                            return dateB - dateA;
                        });

                        console.log('Processed orders:', orders);
                        displayTransactions(currentPage);

                        // Xử lý dữ liệu cho biểu đồ thống kê
                        const monthlyData = {};
                        orders.forEach(order => {
                            const date = new Date(order.createdAt);
                            if (isNaN(date.getTime())) return; // Bỏ qua nếu ngày không hợp lệ
                            
                            const monthYear = `${date.getMonth() + 1}/${date.getFullYear()}`;
                            
                            if (!monthlyData[monthYear]) {
                                monthlyData[monthYear] = { quantity: 0, amount: 0 };
                            }
                            
                            // Tính tổng số lượng sản phẩm
                            if (order.items && Array.isArray(order.items)) {
                                order.items.forEach(item => {
                                    monthlyData[monthYear].quantity += (item.quantity || 1);
                                });
                            }
                            
                            // Tính tổng tiền
                            const amount = order.grandTotal || order.discountedTotal || order.subtotal || 0;
                            monthlyData[monthYear].amount += amount;
                        });

                        // Sắp xếp các tháng theo thứ tự thời gian
                        const sortedLabels = Object.keys(monthlyData).sort((a, b) => {
                            const [monthA, yearA] = a.split('/').map(Number);
                            const [monthB, yearB] = b.split('/').map(Number);
                            return (yearA - yearB) || (monthA - monthB);
                        });

                        const quantities = sortedLabels.map(label => monthlyData[label].quantity);
                        const amounts = sortedLabels.map(label => monthlyData[label].amount);

                        renderPurchaseChart(sortedLabels, quantities, amounts);
                    } else {
                        orders = [];
                        displayTransactions(currentPage);
                        renderPurchaseChart(['Không có dữ liệu'], [0], [0]);
                    }
                }, (error) => {
                    console.error('Error loading orders:', error);
                    Swal.fire({
                        icon: 'error',
                        title: 'Lỗi tải đơn hàng!',
                        text: `Không thể tải đơn hàng: ${error.message}`,
                        showConfirmButton: true
                    });
                    orders = [];
                    displayTransactions(currentPage);
                    renderPurchaseChart(['Lỗi tải dữ liệu'], [0], [0]);
                });
            } else {
                userInfo.style.display = 'none';
                loginLink.style.display = 'inline-block';
                registerLink.style.display = 'inline-block';
                sidebarUserName.textContent = "Chưa đăng nhập";
                sidebarAvatar.src = "images/nguoidung.png";
                profileAvatar.src = "images/nguoidung.png";
                Swal.fire({
                    icon: 'warning',
                    title: 'Chưa đăng nhập!',
                    text: 'Vui lòng đăng nhập để xem thông tin thành viên.',
                    showConfirmButton: true
                }).then(() => {
                    window.location.href = 'index.html';
                });
            }
        });

        // Handle Logout
        document.getElementById('logoutLink')?.addEventListener('click', (e) => {
            e.preventDefault();
            Swal.fire({
                title: 'Bạn có chắc?',
                text: "Bạn muốn đăng xuất khỏi hệ thống?",
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#A63C3C',
                cancelButtonColor: '#6c757d',
                confirmButtonText: 'Đăng Xuất',
                cancelButtonText: 'Hủy'
            }).then((result) => {
                if (result.isConfirmed) {
                    signOut(auth).then(() => {
                        Swal.fire({
                            icon: 'success',
                            title: 'Đăng xuất thành công!',
                            timer: 1500,
                            showConfirmButton: false
                        }).then(() => {
                            window.location.href = 'index.html';
                        });
                    }).catch(error => {
                        Swal.fire({
                            icon: 'error',
                            title: 'Lỗi!',
                            text: `Không thể đăng xuất: ${error.message}.`,
                            showConfirmButton: true
                        });
                    });
                }
            });
        });

        // Đăng xuất từ sidebar
        document.getElementById('sidebarLogout')?.addEventListener('click', function(e) {
            e.preventDefault();
            document.getElementById('logoutLink')?.click();
        });

        // Modal Functions
        window.openModal = function(modalId) {
            document.getElementById(modalId).style.display = 'block';
        };

        window.closeModal = function(modalId) {
            document.getElementById(modalId).style.display = 'none';
        };

        window.switchToRegister = function() {
            closeModal('loginModal');
            openModal('registerModal');
        };

        window.switchToLogin = function() {
            closeModal('registerModal');
            closeModal('forgotPasswordModal');
            openModal('loginModal');
        };

        window.switchToForgotPassword = function() {
            closeModal('loginModal');
            openModal('forgotPasswordModal');
        };

        // Handle Login
        window.handleLogin = function() {
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            const btn = document.getElementById('loginBtn');
            const spinner = document.getElementById('loginSpinner');
            btn.disabled = true;
            spinner.style.display = 'inline-block';
            signInWithEmailAndPassword(auth, email, password)
                .then((userCredential) => {
                    Swal.fire({
                        icon: 'success',
                        title: 'Đăng nhập thành công!',
                        timer: 1500,
                        showConfirmButton: false
                    }).then(() => {
                        closeModal('loginModal');
                        window.location.reload();
                    });
                })
                .catch((error) => {
                    Swal.fire({
                        icon: 'error',
                        title: 'Lỗi!',
                        text: `Đăng nhập thất bại: ${error.message}`,
                        showConfirmButton: true
                    });
                })
                .finally(() => {
                    btn.disabled = false;
                    spinner.style.display = 'none';
                });
        };

        // Handle Register
        window.handleRegister = function() {
            const name = document.getElementById('registerName').value;
            const email = document.getElementById('registerEmail').value;
            const password = document.getElementById('registerPassword').value;
            const btn = document.getElementById('registerBtn');
            const spinner = document.getElementById('registerSpinner');
            btn.disabled = true;
            spinner.style.display = 'inline-block';
            if (password.length < 8) {
                Swal.fire({
                    icon: 'error',
                    title: 'Lỗi!',
                    text: 'Mật khẩu phải có ít nhất 8 ký tự.',
                    showConfirmButton: true
                });
                btn.disabled = false;
                spinner.style.display = 'none';
                return;
            }
            createUserWithEmailAndPassword(auth, email, password)
                .then((userCredential) => {
                    const user = userCredential.user;
                    const userRef = ref(database, `users/${user.uid}`);
                    set(userRef, {
                        name: name,
                        email: email,
                        phone: '',
                        address: '',
                        role: 'user',
                        created_at: new Date().toISOString().split('T')[0],
                        emailVerified: false,
                        deleted: false
                    }).then(() => {
                        updateProfile(user, { displayName: name }).then(() => {
                            Swal.fire({
                                icon: 'success',
                                title: 'Đăng ký thành công!',
                                timer: 1500,
                                showConfirmButton: false
                            }).then(() => {
                                closeModal('registerModal');
                                window.location.reload();
                            });
                        });
                    }).catch((error) => {
                        Swal.fire({
                            icon: 'error',
                            title: 'Lỗi!',
                            text: `Không thể lưu thông tin: ${error.message}`,
                            showConfirmButton: true
                        });
                    });
                })
                .catch((error) => {
                    Swal.fire({
                        icon: 'error',
                        title: 'Lỗi!',
                        text: `Đăng ký thất bại: ${error.message}`,
                        showConfirmButton: true
                    });
                })
                .finally(() => {
                    btn.disabled = false;
                    spinner.style.display = 'none';
                });
        };

        // Handle Forgot Password
        window.handleForgotPassword = function() {
            const email = document.getElementById('forgotPasswordEmail').value;
            const btn = document.getElementById('forgotBtn');
            const spinner = document.getElementById('forgotSpinner');
            btn.disabled = true;
            spinner.style.display = 'inline-block';
            sendPasswordResetEmail(auth, email)
                .then(() => {
                    Swal.fire({
                        icon: 'success',
                        title: 'Thành công!',
                        text: 'Email đặt lại mật khẩu đã được gửi. Vui lòng kiểm tra hộp thư của bạn.',
                        showConfirmButton: true
                    }).then(() => {
                        closeModal('forgotPasswordModal');
                    });
                })
                .catch((error) => {
                    Swal.fire({
                        icon: 'error',
                        title: 'Lỗi!',
                        text: `Không thể gửi email: ${error.message}`,
                        showConfirmButton: true
                    });
                })
                .finally(() => {
                    btn.disabled = false;
                    spinner.style.display = 'none';
                });
        };

        // Hide loading overlay
        window.addEventListener('load', function() {
            setTimeout(function() {
                document.querySelector('.loading-overlay').classList.add('hidden');
            }, 1000);
        });

        // Scroll animation - Tắt observer
        const elements = document.querySelectorAll('.membership-info, .purchase-chart, .transaction-history');
        elements.forEach(el => {
            el.classList.add('visible');
        });

        // Tab chuyển đổi vùng nội dung tài khoản
        document.querySelectorAll('.account-menu ul li a[data-section]').forEach(link => {
            link.addEventListener('click', function(e) {
                e.preventDefault();
                // Xóa active ở sidebar
                document.querySelectorAll('.account-menu ul li').forEach(li => li.classList.remove('active'));
                this.parentElement.classList.add('active');
                // Ẩn tất cả section
                document.querySelectorAll('.account-section').forEach(sec => {
                    sec.classList.remove('active-section');
                    sec.style.display = 'none';
                });
                // Hiện section được chọn
                const sectionId = this.getAttribute('data-section');
                const section = document.getElementById(sectionId);
                if (section) {
                    section.style.display = 'block';
                    section.classList.add('active-section');
                    // Nếu là section biểu đồ, render lại ngay lập tức và resize
                    if (sectionId === 'chartSection' && window.purchaseChartInstance) {
                        window.purchaseChartInstance.update('none');
                        window.purchaseChartInstance.resize();
                    }
                }
            });
        });

        // Thay đổi biểu đồ sang histogram (bar chart)
        function renderPurchaseChart(labels, quantities, amounts) {
            const ctx = document.getElementById('purchaseChart').getContext('2d');
            // Xóa chart cũ nếu có
            if (window.purchaseChartInstance) {
                window.purchaseChartInstance.destroy();
            }
            window.purchaseChartInstance = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [
                        {
                            label: 'Số Lượng Sản Phẩm',
                            data: quantities,
                            backgroundColor: 'rgba(247, 84, 74, 0.6)',
                            borderColor: '#f7544a',
                            borderWidth: 1,
                            yAxisID: 'y1'
                        },
                        {
                            label: 'Tổng Số Tiền (VND)',
                            data: amounts,
                            backgroundColor: 'rgba(74, 47, 26, 0.6)',
                            borderColor: '#4A2F1A',
                            borderWidth: 1,
                            yAxisID: 'y2'
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    animation: false,
                    transitions: {
                        active: {
                            animation: {
                                duration: 0
                            }
                        }
                    },
                    scales: {
                        y1: {
                            type: 'linear',
                            position: 'left',
                            title: { 
                                display: true, 
                                text: 'Số Lượng',
                                font: {
                                    weight: 'bold'
                                }
                            },
                            beginAtZero: true,
                            grid: {
                                color: 'rgba(0, 0, 0, 0.1)'
                            }
                        },
                        y2: {
                            type: 'linear',
                            position: 'right',
                            title: { 
                                display: true, 
                                text: 'Tổng Tiền (VND)',
                                font: {
                                    weight: 'bold'
                                }
                            },
                            beginAtZero: true,
                            grid: { 
                                drawOnChartArea: false 
                            }
                        },
                        x: { 
                            title: { 
                                display: true, 
                                text: 'Tháng',
                                font: {
                                    weight: 'bold'
                                }
                            },
                            grid: {
                                color: 'rgba(0, 0, 0, 0.1)'
                            }
                        }
                    },
                    plugins: { 
                        legend: { 
                            display: true,
                            position: 'top',
                            labels: {
                                font: {
                                    weight: 'bold'
                                }
                            }
                        }
                    }
                }
            });
        }

        // Lấy dữ liệu đơn hàng từ Firebase
        const ordersRef = ref(database, 'orders');
        const q = query(ordersRef, orderBy('createdAt', 'desc'));
        const snapshot = await get(q);
        if (snapshot.exists()) {
            orders = Object.entries(snapshot.val())
                .map(([id, data]) => ({ id, ...data }))
                .filter(order => order.userId === auth.currentUser.uid);
            console.log('Orders loaded:', orders); // Debug log
        }

        // Hàm xem chi tiết đơn hàng
        async function viewOrderDetail(orderId) {
            try {
                const orderRef = ref(database, `orders/${orderId}`);
                const snapshot = await get(orderRef);
                
                if (snapshot.exists()) {
                    const order = snapshot.val();
                    order.id = orderId;

                    // Format ngày giờ
                    const orderDate = new Date(order.createdAt);
                    const formattedDate = orderDate.toLocaleDateString('vi-VN', {
                        day: '2-digit',
                        month: '2-digit',
                        year: 'numeric'
                    });
                    const formattedTime = orderDate.toLocaleTimeString('vi-VN', {
                        hour: '2-digit',
                        minute: '2-digit'
                    });

                    // Tạo danh sách sản phẩm
                    const productsList = order.items?.map(item => `
                        <div class="d-flex align-items-center mb-3 p-2 bg-light rounded">
                            <img src="${item.image || '../images/default-product.png'}" 
                                 alt="${item.name}"
                                 class="me-3" 
                                 style="width: 60px; height: 60px; object-fit: cover; border-radius: 8px;">
                            <div class="flex-grow-1">
                                <div class="fw-500">${item.name}</div>
                                <div class="text-muted small">
                                    ${item.quantity}x × ${item.price?.toLocaleString('vi-VN')}đ
                                </div>
                            </div>
                            <div class="text-end fw-500">
                                ${(item.price * item.quantity).toLocaleString('vi-VN')}đ
                            </div>
                        </div>
                    `).join('') || '<div class="text-muted">Không có sản phẩm</div>';

                    // Debug log
                    console.log('Order details:', {
                        subtotal: order.subtotal,
                        grandTotal: order.grandTotal,
                        discountAmount: order.discountAmount,
                        couponCode: order.couponCode
                    });

                    // Tạo nội dung modal
                    const modalContent = `
                        <div class="modal-header">
                            <h5 class="modal-title">Chi tiết đơn hàng #${orderId}</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                        </div>
                        <div class="modal-body">
                            <div class="mb-4">
                                <div class="d-flex justify-content-between mb-2">
                                    <span class="text-muted">Ngày đặt:</span>
                                    <span class="fw-500">${formattedDate} ${formattedTime}</span>
                                </div>
                                <div class="d-flex justify-content-between mb-2">
                                    <span class="text-muted">Trạng thái:</span>
                                    <span class="badge ${getStatusBadgeClass(order.status)}">${getStatusText(order.status)}</span>
                                </div>
                                <div class="d-flex justify-content-between mb-2">
                                    <span class="text-muted">Phương thức thanh toán:</span>
                                    <span class="fw-500">${getPaymentMethodText(order.paymentMethod)}</span>
                                </div>
                                <div class="d-flex justify-content-between">
                                    <span class="text-muted">Địa chỉ giao hàng:</span>
                                    <span class="fw-500 text-end">${order.shippingInfo?.address || 'Chưa có địa chỉ'}</span>
                                </div>
                            </div>

                            <div class="mb-4">
                                <h6 class="mb-3">Sản phẩm đã đặt</h6>
                                ${productsList}
                            </div>

                            <div class="border-top pt-3">
                                <div class="d-flex justify-content-between mb-2">
                                    <span class="text-muted">Tạm tính:</span>
                                    <span>${order.subtotal?.toLocaleString('vi-VN')}đ</span>
                                </div>
                                <div class="d-flex justify-content-between mb-2">
                                    <span class="text-muted">Phí vận chuyển:</span>
                                    <span>${(order.shippingFee || 0).toLocaleString('vi-VN')}đ</span>
                                </div>
                                ${order.discountAmount ? `
                                <div class="d-flex justify-content-between mb-2">
                                    <span class="text-muted">
                                        ${order.couponCode ? `Mã giảm giá (${order.couponCode}):` : 'Giảm giá:'}
                                    </span>
                                    <span class="text-danger">-${order.discountAmount.toLocaleString('vi-VN')}đ</span>
                                </div>
                                ` : ''}
                                <div class="d-flex justify-content-between fw-bold mt-2 pt-2 border-top">
                                    <span>Tổng cộng:</span>
                                    <span class="text-primary">${order.grandTotal?.toLocaleString('vi-VN')}đ</span>
                                </div>
                            </div>

                            ${order.status === 'pending' ? `
                                <div class="mt-4">
                                    <button class="btn btn-danger w-100" onclick="cancelOrder('${orderId}')">
                                        Hủy đơn hàng
                                    </button>
                                </div>
                            ` : ''}
                        </div>
                    `;

                    // Hiển thị modal
                    const modalElement = document.getElementById('orderDetailModal');
                    modalElement.querySelector('.modal-content').innerHTML = modalContent;
                    const modal = new bootstrap.Modal(modalElement);
                    modal.show();
                }
            } catch (error) {
                console.error('Error loading order details:', error);
                Swal.fire({
                    icon: 'error',
                    title: 'Lỗi!',
                    text: 'Không thể tải chi tiết đơn hàng. Vui lòng thử lại sau.'
                });
            }
        }

        // Hiển thị danh sách đơn hàng
        const ordersList = document.getElementById('ordersList');
        ordersList.innerHTML = orders.map(order => `
            <div class="order-item mb-3 p-3 border rounded">
                <div class="d-flex justify-content-between align-items-start mb-3">
                    <div>
                        <div class="text-muted small">Mã đơn hàng: #${order.id}</div>
                        <div class="text-muted small">${formatDate(order.createdAt)}</div>
                    </div>
                    <span class="badge ${getStatusBadgeClass(order.status)}">${getStatusText(order.status)}</span>
                </div>
                
                <div class="products-preview mb-3">
                    ${order.items?.map(item => `
                        <div class="product-item d-flex align-items-center mb-2">
                            <img src="${item.image || '../images/default-product.png'}" 
                                 alt="${item.name}" 
                                 class="product-image me-3">
                            <div>
                                <div class="product-name">${item.name}</div>
                                <div class="text-muted small">
                                    ${item.quantity}x × ${item.price?.toLocaleString('vi-VN')}đ
                                </div>
                            </div>
                        </div>
                    `).join('') || '<div class="text-muted">Không có sản phẩm</div>'}
                </div>
                
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <div class="text-muted">Tổng tiền: <span class="text-dark fw-500">${order.grandTotal?.toLocaleString('vi-VN')}đ</span></div>
                        ${order.couponCode ? `
                        <div class="text-muted small">
                            <i class="fas fa-tag text-success me-1"></i>
                            Đã áp dụng mã: ${order.couponCode}
                        </div>
                        ` : ''}
                    </div>
                    <button class="btn btn-primary btn-sm" onclick="viewOrderDetail(${JSON.stringify(order)})">
                        Xem chi tiết
                    </button>
                </div>
            </div>
        `).join('');

        // Thêm hàm xem chi tiết đơn hàng vào window để có thể gọi từ onclick
        window.viewOrderDetail = viewOrderDetail;
    </script>
    <!-- Order Detail Modal -->
    <div class="modal fade" id="orderDetailModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <!-- Content will be loaded dynamically -->
            </div>
        </div>
    </div>
   <!-- Bottom Navigation Bar cho mobile -->
                   <div class="bottom-nav">
                    <a href="index.html" class="nav-home"><i class="fa fa-home"></i><span></span>Trang chủ</span></a>
                    <a href="news.html" class="nav-news"><i class="fa fa-file-text-o"></i><span>Tin tức</span></a>
                    <a href="menu.html" class="nav-account"><i class="fa fa-coffee"></i><span>Menu</span></a>
                    <a href="cart.html" class="nav-cart"><i class="fa fa-shopping-cart"></i><span>Giỏ hàng</span></a>
                    <a href="policy.html" class="nav-policy"><i class="fa fa-file-text-o"></i><span>Chính sách</span></a>
                    <a href="about.html" class="nav-about"><i class="fa fa-info-circle"></i><span>Giới thiệu</span></a>
                  </div>
              
                  <div class="appbar-mobile">
                    <div class="appbar-left">
                      <a href="index.html"><img src="images/logo.png" alt="Ấm" class="appbar-logo"></a>
                    </div>
                    <div class="appbar-right">
                      <a href="member.html" class="appbar-account"><i class="fa fa-user"></i></a>
                    </div>
                  </div>
</body>
</html>